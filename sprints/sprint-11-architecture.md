# Sprint 11 - Arquitetura de IntegraÃ§Ã£o

## ğŸ—ï¸ VisÃ£o Geral

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        GT-Vision VMS                             â”‚
â”‚                     Arquitetura Integrada                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Frontend   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚   HAProxy    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚     Kong     â”‚
â”‚   (React)    â”‚         â”‚  (Proxy)     â”‚         â”‚  (Gateway)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                           â”‚
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
                         â”‚                                       â”‚
                         â–¼                                       â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚  Django Backend â”‚                   â”‚ FastAPI Stream  â”‚
                â”‚  (Admin+Cidades)â”‚                   â”‚  (Streaming+AI) â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚                                       â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                â”‚                â”‚         â”‚           â”‚          â”‚
        â–¼                â–¼                â–¼         â–¼           â–¼          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”
â”‚  PostgreSQL  â”‚  â”‚  Redis   â”‚  â”‚   RabbitMQ   â”‚  â”‚MinIOâ”‚  â”‚Mediaâ”‚  â”‚Redisâ”‚
â”‚  (Database)  â”‚  â”‚ (Cache)  â”‚  â”‚   (Queue)    â”‚  â”‚(S3) â”‚  â”‚ MTX â”‚  â”‚     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—„ï¸ Camada de Dados

### PostgreSQL (Banco Principal)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      PostgreSQL 15                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ Admin Contextâ”‚  â”‚Cidades Contextâ”‚  â”‚Stream Contextâ”‚     â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”‚
â”‚  â”‚ â€¢ users      â”‚  â”‚ â€¢ cidades    â”‚  â”‚ â€¢ streams    â”‚     â”‚
â”‚  â”‚ â€¢ roles      â”‚  â”‚ â€¢ cameras    â”‚  â”‚ â€¢ recordings â”‚     â”‚
â”‚  â”‚ â€¢ user_roles â”‚  â”‚              â”‚  â”‚ â€¢ clips      â”‚     â”‚
â”‚  â”‚              â”‚  â”‚              â”‚  â”‚ â€¢ mosaics    â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                           â”‚
â”‚  â”‚  AI Context  â”‚                                           â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                           â”‚
â”‚  â”‚ â€¢ lpr_events â”‚                                           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                           â”‚
â”‚                                                              â”‚
â”‚  Total: 9 tabelas + 12 Ã­ndices                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Redis (Cache)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Redis 7                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  â€¢ Session cache (Django)                                   â”‚
â”‚  â€¢ API response cache                                       â”‚
â”‚  â€¢ Stream status cache                                      â”‚
â”‚  â€¢ Rate limiting counters                                   â”‚
â”‚  â€¢ Temporary data (TTL)                                     â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### MinIO (Object Storage)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MinIO (S3-compatible)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  recordings  â”‚  â”‚    clips     â”‚  â”‚  lpr-images  â”‚     â”‚
â”‚  â”‚              â”‚  â”‚              â”‚  â”‚              â”‚     â”‚
â”‚  â”‚ â€¢ MP4 files  â”‚  â”‚ â€¢ MP4 clips  â”‚  â”‚ â€¢ JPG/PNG    â”‚     â”‚
â”‚  â”‚ â€¢ Retention  â”‚  â”‚ â€¢ On-demand  â”‚  â”‚ â€¢ Evidence   â”‚     â”‚
â”‚  â”‚   7/15/30d   â”‚  â”‚              â”‚  â”‚              â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                           â”‚
â”‚  â”‚  thumbnails  â”‚                                           â”‚
â”‚  â”‚              â”‚                                           â”‚
â”‚  â”‚ â€¢ 160x90 JPG â”‚                                           â”‚
â”‚  â”‚ â€¢ Timeline   â”‚                                           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                           â”‚
â”‚                                                              â”‚
â”‚  Total: 4 buckets                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Camada de Mensageria

### RabbitMQ (Message Broker)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       RabbitMQ 3                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  Exchange: streaming.events (topic)                         â”‚
â”‚  â”œâ”€ Queue: recordings                                       â”‚
â”‚  â”‚  â”œâ”€ Worker: RecordingWorker                             â”‚
â”‚  â”‚  â”œâ”€ DLQ: recordings.dlq                                 â”‚
â”‚  â”‚  â””â”€ Retry: 3x with backoff                              â”‚
â”‚  â”‚                                                          â”‚
â”‚  â”œâ”€ Queue: clips                                            â”‚
â”‚  â”‚  â”œâ”€ Worker: ClipWorker                                  â”‚
â”‚  â”‚  â”œâ”€ DLQ: clips.dlq                                      â”‚
â”‚  â”‚  â””â”€ Retry: 3x with backoff                              â”‚
â”‚  â”‚                                                          â”‚
â”‚  â””â”€ Queue: cleanup                                          â”‚
â”‚     â”œâ”€ Worker: CleanupService                              â”‚
â”‚     â””â”€ Schedule: Cron (daily)                              â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¥ Camada de Streaming

### MediaMTX

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        MediaMTX                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  Input: RTSP (cÃ¢meras IP)                                   â”‚
â”‚  â”œâ”€ rtsp://camera1/stream                                   â”‚
â”‚  â”œâ”€ rtsp://camera2/stream                                   â”‚
â”‚  â””â”€ rtsp://cameraN/stream                                   â”‚
â”‚                                                              â”‚
â”‚  Output:                                                     â”‚
â”‚  â”œâ”€ HLS (HTTP Live Streaming)                               â”‚
â”‚  â”‚  â””â”€ http://localhost:8888/camera1/index.m3u8            â”‚
â”‚  â”‚                                                          â”‚
â”‚  â”œâ”€ WebRTC (Ultra-low latency)                              â”‚
â”‚  â”‚  â””â”€ ws://localhost:8889/camera1                         â”‚
â”‚  â”‚                                                          â”‚
â”‚  â””â”€ RTSP (Re-stream)                                        â”‚
â”‚     â””â”€ rtsp://localhost:8554/camera1                        â”‚
â”‚                                                              â”‚
â”‚  API: http://localhost:9997                                 â”‚
â”‚  â”œâ”€ GET /v3/paths/list                                      â”‚
â”‚  â”œâ”€ POST /v3/config/paths/add/{name}                        â”‚
â”‚  â””â”€ DELETE /v3/config/paths/remove/{name}                   â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”Œ Fluxo de Dados

### 1. IngestÃ£o de Stream

```
Camera (RTSP)
    â”‚
    â–¼
MediaMTX (Ingest)
    â”‚
    â”œâ”€â”€â–¶ HLS Output
    â”œâ”€â”€â–¶ WebRTC Output
    â””â”€â”€â–¶ Recording (FFmpeg)
         â”‚
         â–¼
    RabbitMQ (recordings queue)
         â”‚
         â–¼
    RecordingWorker
         â”‚
         â”œâ”€â”€â–¶ Process video (FFmpeg)
         â”œâ”€â”€â–¶ Upload to MinIO
         â””â”€â”€â–¶ Save metadata to PostgreSQL
```

### 2. CriaÃ§Ã£o de Clip

```
User Request (API)
    â”‚
    â–¼
CreateClipUseCase
    â”‚
    â”œâ”€â”€â–¶ Validate recording exists (PostgreSQL)
    â”œâ”€â”€â–¶ Create clip entity
    â””â”€â”€â–¶ Publish to RabbitMQ (clips queue)
         â”‚
         â–¼
    ClipWorker
         â”‚
         â”œâ”€â”€â–¶ Download recording from MinIO
         â”œâ”€â”€â–¶ Extract clip (FFmpeg)
         â”œâ”€â”€â–¶ Upload clip to MinIO
         â””â”€â”€â–¶ Update status in PostgreSQL
```

### 3. Evento LPR

```
Camera (Webhook)
    â”‚
    â–¼
FastAPI Endpoint (/api/lpr/events)
    â”‚
    â–¼
ReceiveLPREventUseCase
    â”‚
    â”œâ”€â”€â–¶ Validate event
    â”œâ”€â”€â–¶ Upload image to MinIO
    â”œâ”€â”€â–¶ Save event to PostgreSQL
    â””â”€â”€â–¶ Cache recent events (Redis)
```

---

## ğŸ” Camada de SeguranÃ§a

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Security Layer                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  HAProxy (Load Balancer)                                    â”‚
â”‚  â”œâ”€ SSL/TLS termination                                     â”‚
â”‚  â”œâ”€ Rate limiting                                           â”‚
â”‚  â””â”€ Health checks                                           â”‚
â”‚                                                              â”‚
â”‚  Kong (API Gateway)                                         â”‚
â”‚  â”œâ”€ JWT authentication                                      â”‚
â”‚  â”œâ”€ CORS policies                                           â”‚
â”‚  â”œâ”€ Request validation                                      â”‚
â”‚  â””â”€ API versioning                                          â”‚
â”‚                                                              â”‚
â”‚  Application                                                 â”‚
â”‚  â”œâ”€ Input sanitization                                      â”‚
â”‚  â”œâ”€ SQL injection prevention (prepared statements)          â”‚
â”‚  â”œâ”€ XSS prevention                                          â”‚
â”‚  â””â”€ CSRF tokens                                             â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Camada de Observabilidade

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Observability Stack                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  Prometheus (Metrics)                                       â”‚
â”‚  â”œâ”€ Application metrics                                     â”‚
â”‚  â”œâ”€ System metrics                                          â”‚
â”‚  â”œâ”€ Business metrics                                        â”‚
â”‚  â””â”€ Exporters (node, postgres, redis)                       â”‚
â”‚                                                              â”‚
â”‚  Grafana (Visualization)                                    â”‚
â”‚  â”œâ”€ System dashboard                                        â”‚
â”‚  â”œâ”€ Application dashboard                                   â”‚
â”‚  â””â”€ Business dashboard                                      â”‚
â”‚                                                              â”‚
â”‚  ELK Stack (Logs)                                           â”‚
â”‚  â”œâ”€ Elasticsearch (storage)                                 â”‚
â”‚  â”œâ”€ Logstash (processing)                                   â”‚
â”‚  â””â”€ Kibana (visualization)                                  â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ MigraÃ§Ã£o: In-Memory â†’ Real

### Antes (Sprints 0-10)

```
Application
    â”‚
    â–¼
Repository (Interface)
    â”‚
    â–¼
InMemoryRepository
    â”‚
    â””â”€â”€â–¶ Dict/List (Python)
```

### Depois (Sprint 11)

```
Application
    â”‚
    â–¼
Repository (Interface)
    â”‚
    â–¼
PostgreSQLRepository
    â”‚
    â””â”€â”€â–¶ PostgreSQL (Real DB)
```

### Exemplo: StreamRepository

**Antes**:
```python
class StreamRepositoryInMemory(StreamRepository):
    def __init__(self):
        self._streams: Dict[UUID, Stream] = {}
    
    async def save(self, stream: Stream) -> Stream:
        self._streams[stream.id] = stream
        return stream
```

**Depois**:
```python
class StreamRepositoryPostgreSQL(StreamRepository):
    def __init__(self, db: Database):
        self.db = db
    
    async def save(self, stream: Stream) -> Stream:
        async with self.db.session() as session:
            await session.execute(
                "INSERT INTO streams (...) VALUES (...)",
                {...}
            )
        return stream
```

---

## ğŸ¯ BenefÃ­cios da IntegraÃ§Ã£o

### Performance
âœ… PersistÃªncia real (dados nÃ£o se perdem)  
âœ… Queries otimizadas (Ã­ndices)  
âœ… Cache distribuÃ­do (Redis)  
âœ… Processamento assÃ­ncrono (RabbitMQ)  

### Escalabilidade
âœ… Connection pooling  
âœ… Horizontal scaling (workers)  
âœ… Load balancing (HAProxy)  
âœ… Distributed storage (MinIO)  

### Confiabilidade
âœ… ACID transactions (PostgreSQL)  
âœ… Message persistence (RabbitMQ)  
âœ… Retry mechanisms  
âœ… Dead letter queues  

### Observabilidade
âœ… Metrics (Prometheus)  
âœ… Logs (ELK)  
âœ… Tracing (futuro)  
âœ… Alerting (Grafana)  

---

## ğŸ“ PrÃ³ximos Passos

1. âœ… **Setup completo** (Fase 1)
2. â³ **Migrar repositories** (Fase 2)
3. â³ **Integrar RabbitMQ** (Fase 3)
4. â³ **Validar MinIO** (Fase 4)
5. â³ **Testes E2E** (Fase 5)

---

**DocumentaÃ§Ã£o**: Ver `sprints/sprint-11-quickstart.md` para comeÃ§ar
